<div class="jumbotron">
  <div class="heading-2" style="text-align:right;width:100%">
    <span style="float:left">
      <h4>Party Invoice</h4>
    </span>
    <% if @party_invoice.invoice_cancelled %>
      <p class="cancelled-banner" style="float:right; font-size:13px;">Cancelled</p>
    <% end %>
  </div>
  <div class="show">
    <table class="table table-striped">
      <tr>
        <td class="row-right">
          <strong>Party Code:</strong>
        </td>
        <td>
          <%= @party_invoice.party_code%>

        </td>
        <td class="row-right">
          <strong>Party Name:</strong>
        </td>
        <td>
          <%= @party_invoice.party_name %>
        </td>
      </tr>
      <tr>
        <td class="row-right">
          <strong>Invoice Number:</strong>
        </td>
        <td>
          <%= @party_invoice.invoice_number %>
        </td>
        <td class="row-right">
          <strong>Invoice Date:</strong>
        </td>
        <td>
          <%= @party_invoice.invoice_date %>
        </td>
      </tr>
      <% if @party_invoice.invoice_cancelled %>
        <tr>
          <td class="row-right">
            <strong>Reason for cancellation:</strong>
          </td>
          <td>
            <%= @party_invoice.reason_for_cancellation %>
          </td>
        </tr>
        <% end %>
    </table>
    <% if !@party_invoice.bills.empty? %>
      <table class="table table-striped">
      <thead>
      <tr>
        <th>Date</th>
        <th>G R Number</th>
        <th>Truck Number</th>
        <th>Weight</th>
        <th>Kanta</th>
        <th>Rate</th>
        <th>Freight</th>
        <th>Advance</th>
        <th>Balance</th>
      </tr>
      </thead>

      <tbody>
      <% @party_invoice.bills.each do |bill| %>
        <tr>
          <td><%= bill.entry.entry_date %></td>
          <td><%= bill.entry.payment_summary.g_r_number %></td>
          <td><%= bill.entry.truck_number %></td>
          <td><%= bill.weight2 %></td>
          <td><%= bill.kanta2 %></td>
          <td><%= bill.entry.rate2 %></td>
          <td><%= bill.freight %></td>
          <td><%= bill.entry.party_advance_2 %></td>
          <td><%= bill.balance %></td>
        </tr>
      <% end %>
      </tbody>
    </table>
    <% end %>
    <% if @party_invoice.invoice_cancelled %>
      <%= link_to 'Go to the revised party invoice', party_invoice_path(@party_invoice.revised_invoice_id), class: "btn btn-lg btn-primary" %>
    <% end %>
    <% if !@party_invoice.invoice_cancelled %>
      <%= link_to "Download PDF",
                download_party_invoice_path(@party_invoice, format: "pdf"),
                target: "_blank",
                class: "btn btn-lg btn-primary" %>
      <% if current_user.admin? %>
        <button type="button" class="btn btn-lg btn-primary" data-toggle="modal" data-target="#invoiceNumberModal">Cancel</button>
      <% end %>
    <% end %>
    <%= link_to 'Back', party_invoices_path, class: "btn btn-lg btn-primary" %>
    <div id="invoiceNumberModal" class="modal fade" role="dialog">
      <div class="modal-dialog">

        <!-- Modal content-->
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal">&times;</button>
            <h4 class="modal-title">Enter the invoice number for the revised Party Invoice</h4>
          </div>
          <div class="modal-body">
            <%= form_for :party_invoice, url: party_invoice_path(@party_invoice), formtarget: :_blank, method: :delete do |f| %>
              <div class="shift mb-1">
                <%= f.label :invoice_number, class: "required" %>
                <%= f.text_field :invoice_number, class: "form-control", required: true %>
              </div>

              <div class="shift mb-1">
                <%= f.label :reason_for_cancellation, class: "required" %>
                <%= f.text_field :reason_for_cancellation, class: "form-control", required: true %>
              </div>
              <td><%= f.submit 'Cancel', class: "btn btn-lg btn-primary",  input_html: {"data-dismiss": "modal", "aria-hidden": "true" } %></td>
            <% end %>
          </div>
        </div>

      </div>
    </div>

  </div>
</div>